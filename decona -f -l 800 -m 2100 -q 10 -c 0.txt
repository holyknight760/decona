#demultiplex 필요없고, fasta 형태의 데이터베이스를 NCBI 형태의 데이터베이스로 변환하는데 용이
decona -f -l 800 -m 2100 -q 10 -c 0.80 -n 25 -M -B small_database_aquarium.fasta
#-B로 이미 하드에 만들어진 NCBI 데이터베이스를 기반으로 분석이 진행됨. 
decona -f -l 800 -m 2100 -q 10 -c 0.80 -n 25 -M -b /mnt/c/Wild_INU/decona/example_data/BLASTdatabase/small_database_aquarium.fasta
decona -f -l 800 -m 2100 -q 10 -c 0.80 -n 25 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta


decona -f -l 800 -m 2100 -q 10 -c 0.80 -n 25 -M -b /mnt/d/parasite_18S/ncbi-refseqs_1719ea-seqs-derep-uniq.fasta
decona -f -l 800 -m 2100 -q 10 -c 0.80 -n 25 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#Waring: When using a short fragment (<300 bases) please adjust kmer length ( -k ) accordingly
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#Blasting consensus sequences barcode17_concatenated/
#BLAST Database error: No alias or index file found for nucleotide database [/mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta] in search path [/mnt/c/Wild_INU/decona/example_data/parasite_18S/data/barcode17_concatenated/multi-seq::]
#Building a new DB
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -B /mnt/c/Wild_INU/decona/example_data/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -B /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#16s DB 제작 but...실패
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -B /mnt/c/Wild_INU/decona/example_data/16s/dna-sequences.fasta
#(decona) holyknightt@SME189W2WDP030:/mnt/c/Wild_INU/decona/example_data/16s$ decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -B /mnt/c/Wild_INU/decona/example_data/16s/dna-sequences.fasta
#Building a new DB, current time: 02/29/2024 14:23:50
#New DB name:   /mnt/c/Wild_INU/decona/example_data/16s/dna-sequences.fasta
#New DB title:  /mnt/c/Wild_INU/decona/example_data/16s/dna-sequences.fasta
#Sequence type: Nucleotide
#Keep MBits: T
#Maximum file size: 1000000000B
#BLAST options error: File /mnt/c/Wild_INU/decona/example_data/16s/dna-sequences.fasta does not exist
#그래서 그냥 fasta 파일 기반으로 decona 실행!
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -b /mnt/c/Wild_INU/decona/example_data/16s/dna-sequences.fasta
decona -f -l 100 -m 2100 -q 10 -c 0.95 -n 25 -k 10 -M -b /mnt/c/Users/MSI/Documents/GitHub/decona/example_data/16s/dna-sequences.fasta
#이때, 실행 폴더 아래에는 subfolder는 1개만 존재해야 함. 그렇지 않으면 'mv: cannot stat '*_concatenated.fastq': No such file or directory' 메세지가 뜸. 
#-B 옵션은 파일 경로가 있으면 작동 불가!!
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -B dna-sequences.fasta
decona -f -l 100 -m 2100 -q 10 -c 0.95 -n 25 -k 10 -M -b /mnt/c/Wild_INU/decona/example_data/love_bug_16s/BLASTdatabase/dna-sequences.fasta
#(decona) holyknightt@DESKTOP-2PB6NR2:/mnt/c/Users/MSI/Documents/GitHub/decona/example_data/love_bug_16s_95$ decona -f -l 100 -m 2100 -q 10 -c 0.95 -n 25 -k 10 -M -B dna-sequences.fasta

#Standalone BLAST Setup for Unix_하드에 인스톨한 ncbi 도구로 ncbi용 데이터베이스 제작!
#https://www.ncbi.nlm.nih.gov/books/NBK52640/
$ makeblastdb -in silva-138-99-seqs.fasta -dbtype nucl -title silva-138-99-seqs -out silva-138-99-seqs
#만들어진 데이터베이스에 fasta 서열을 blast! 
$ blastn -db silva-138-99-seqs -query All_barcodes_combined.fasta -task blastn -dust no -outfmt "7 delim=, qacc sacc evalue bitscore qcovus pident" -max_target_seqs 23
#요약이 되지 않고, 모든 결과값을 보여줌. 
$ blastn -db silva-138-99-seqs -query All_barcodes_combined.fasta -task blastn -dust no -outfmt "10 qseqid sseqid pident length mismatch gapopen evalue bitscore stitle" -max_target_seqs 23 -out BLAST_out_All_barcodes_combined.txt
#barcode01_concatenated_racon-11430-8,d__Bacteria;,98.631,1461,10,5,0.0,2532,d__Bacteria; p__Proteobacteria; c__Alphaproteobacteria; o__Rickettsiales; f__Rickettsiaceae; g__Rickettsia; s__uncultured_bacterium
$ blastn -db silva-138-99-seqs -query All_barcodes_combined.fasta -task blastn -dust no -outfmt "7 qaccver saccver pident length mismatch gapopen evalue bitscore qcovs" -max_target_seqs 23 -out summary_BLAST_out_All_barcodes_combined.txt
$ blastn -db silva-138-99-seqs -query All_barcodes_combined.fasta -task blastn -dust no -outfmt "7 qaccver saccver pident length mismatch gapopen evalue bitscore qcovs stitle" -max_target_seqs 23 -out summary_BLAST_out_All_barcodes_combined.txt
#
#학교 컴퓨터_ncbi database는 .nsq, .nhr, .nin으로 구성됨. 이때 만들어질 때 사용된 database 이름으로 작동됨. 예로 'silva-138-99-seqs'
$ blastn -db /mnt/c/Wild_INU/decona/example_data/love_bug_16s/database/silva_full/silva-138-99-seqs -query All_barcodes_combined.fasta -task blastn -dust no -outfmt "7 qaccver saccver pident length mismatch gapopen evalue bitscore qcovs stitle" -max_target_seqs 23 -out summary_BLAST_out_All_barcodes_combined.txt
#barcode01_concatenated_racon-25-2613	d__Bacteria;	99.042	1462	11	2	0.0	2568	100	d__Bacteria; p__Proteobacteria; c__Alphaproteobacteria; o__Rickettsiales; f__Rickettsiaceae; g__Rickettsia; s__uncultured_bacterium

#데이터베이스 fasta 파일만 자꾸 지정한 경로로 이동하게 되며, 다음과 같은 오류 메세지가 뜬다. 
#Building a new DB, current time: 09/25/2023 10:47:20
#New DB name:   /mnt/c/Wild_INU/decona/example_data/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#New DB title:  /mnt/c/Wild_INU/decona/example_data/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#Sequence type: Nucleotide
#Keep MBits: T
#Maximum file size: 1000000000B
#BLAST options error: File /mnt/c/Wild_INU/decona/example_data/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta does not exist
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 10 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta

#**-k****set custom kmer length, short reads require smaller kmer length (default 15)**
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 14 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta
##Building a new DB_>400Mb, not working!!
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 14 -M -B /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta

#when >=3ea folder make Clustering reads...
The error message you've received indicates that the `cd-hit-est` command, which is a part of the CD-HIT software package used for clustering sequences, is not found in your current environment's PATH.
#    conda install -c bioconda cd-hit
#    which cd-hit-est
#    which conda
#    export PATH="/home/holyknightt/miniconda3/envs/decona/bin/:$PATH"

#-B로 이미 하드에 만들어진 NCBI 데이터베이스를 기반으로 분석이 진행됨.
#notebook_7ea find
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 14 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#notebook_9ea find and 간흡충은 Paragonimus westermani와 유사
decona -f -l 100 -m 2100 -q 10 -c 1.00 -n 25 -k 14 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
##18S_V9_300bp_9ea find and 간흡충은 Paragonimus westermani와 유사
decona -f -T 20 -l 100 -m 300 -q 10 -c 1.00 -n 5 -k 6 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#re-cluster consensus sequences
decona -f -l 100 -m 2100 -q 10 -c 1.00 -n 25 -r 0.99 -R 500 -k 14 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
##barcode08_1950bp_서열이 1개씩 독립적으로 존재할 때, blast 결과가 없음. 
decona -f -T 20 -l 1850 -m 2300 -q 10 -c 1.00 -n 5 -k 15 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
##barcode08_1950bp_클러스터 사이즈 100이 되면 100개의 서열을 하나로 묶음. 그래서 많은 서열이 없어짐. 
decona -f -T 20 -l 1850 -m 2300 -q 10 -c 0.80 -n 100 -k 15 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
##barcode08_1950bp_클러스터 사이즈 100이 되면 5개의 서열을 하나로 묶음.  
decona -f -T 20 -l 1850 -m 2300 -q 10 -c 0.80 -n 5 -k 15 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
##barcode08_1950bp_서열이 약 1개씩 독립적으로 존재할 때, 클러스터 identity 0.8은 0.99보다 결과가 다양하다. 
decona -f -T 20 -l 1850 -m 2300 -q 10 -c 0.99 -n 5 -k 15 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#re-cluster consensus sequences-'-p'옵션은 fastq 파일이 있는 폴더에서 실행하면, 간략한 서열 길이를 알 수 있다. 
decona -f -p
#3.2175시간 소요됨. blast 결과도 볼 수 없음. 간흡충과 폐흡충이 개별로 존재하지 않음. 다만, 폐흡충은 독립적으로 서열이 존재함. 
decona -f -T 20 -l 355 -m 2327 -q 10 -c 0.80 -n 5 -r 0.99 -R 500 -k 15 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#blast 결과도 볼 수 없음. 재클러스트로 나눠지지도 않음. 
decona -f -T 20 -l 134 -m 362 -q 10 -c 0.80 -n 5 -r 0.99 -R 500 -k 6 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta
#짧은 서열을 1918bp로 한정해서 실시해봄. blast 결과가 나오지 않음. total raw sequences = 306448, total filtered sequences = 66753
decona -f -T 20 -l 1918 -m 2327 -q 10 -c 0.80 -n 5 -r 0.99 -R 500 -k 15 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta

  
#desktop
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 14 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta
decona -f -l 100 -m 2100 -q 10 -c 0.80 -n 25 -k 14 -M -b /mnt/c/Users/holyknightt/'Geneious 2023.2 Data'/BLAST/data
##18S_V9_300bp
decona -f -T 20 -l 100 -m 300 -q 10 -c 1.00 -n 5 -k 14 -M -b /mnt/e/Nanopore/ncbi-refseqs_18S_v220513-derep-uniq.fasta


#https://www.readcube.com/library/6a892c3a-8653-4b22-88cb-6d624da7e92e:e7f9884f-3dda-4b66-91ff-8fc8ae5f027a
2kb: decona -f -T 20 -l 1800 -m 2350 -g 1 "GGATTACCCYACTATGC;max_error_rate=0.1;min_overlap=17…CTAGGGATAACAGCGCAATC;max_error_rate=0.1;min_overlap=17" -n 5 -r 0.99= -R 500 -M
18S_V9: decona -f -T 20 -l 100 -m 350 -g 1 "GTACACACCGCCCGTC;max_error_rate=0.1;min_overlap=20…TGATCCTTCTGCAGGTTCACCTAC;max_error_rate=0.1;min_overlap=20" -n 5 -r 0.99= -R 500 -k 6 -M
decona -f -T 20 -l 100 -m 300 -g 1 -n 5 -r 0.99 -R 500 -k 6 -M -b /mnt/d/parasite_18S/ncbi-refseqs_18S_v220513-derep-uniq.fasta



