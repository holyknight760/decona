$ find /mnt/d/ticks/12s/Downloads -name *.fastq.gz -print > list.txt

$ qiime tools import \
  --type 'SampleData[PairedEndSequencesWithQuality]' \
  --input-path manifest_12s.txt \
  --output-path paired-end-demux.qza \
  --input-format PairedEndFastqManifestPhred33V2 

#Demultiplexing
$ qiime vsearch merge-pairs \
  --i-demultiplexed-seqs paired-end-demux.qza \
  --o-merged-sequences demux-joined.qza
#Saved SampleData[JoinedSequencesWithQuality] to: demux-joined.qza

$ qiime demux summarize \
  --i-data demux-joined.qza \
  --o-visualization demux-joined.qzv

$ qiime quality-filter q-score \
  --i-demux demux-joined.qza \
  --o-filtered-sequences demux-joined-filtered.qza \
  --o-filter-stats demux-joined-filter-stats.qza
#Saved SampleData[JoinedSequencesWithQuality] to: demux-joined-filtered.qza
#Saved QualityFilterStats to: demux-joined-filter-stats.qza

$ qiime vsearch dereplicate-sequences \
--i-sequences demux-joined.qza \
--o-dereplicated-table primer_trimed_filtered_demulti_table \
--o-dereplicated-sequences primer_trimed_filtered_demulti_seq \
--verbose
#Saved FeatureTable[Frequency] to: primer_trimed_filtered_demulti_table.qza
#Saved FeatureData[Sequence] to: primer_trimed_filtered_demulti_seq.qza

$ qiime feature-table summarize \
--i-table primer_trimed_filtered_demulti_table.qza \
--o-visualization primer_trimed_filtered_demulti_table.qzv \
--verbose

$ qiime feature-table tabulate-seqs \
--i-data primer_trimed_filtered_demulti_seq.qza \
--o-visualization primer_trimed_filtered_demulti_seq.qzv 

# Clustering
$ qiime vsearch cluster-features-de-novo \
--i-table primer_trimed_filtered_demulti_table.qza \
--i-sequences primer_trimed_filtered_demulti_seq.qza \
--p-perc-identity 0.98 \
--p-threads 32 \
--o-clustered-table table-dncluster98.qza \
--o-clustered-sequences rep-seqs-dncluster98.qza \
--verbose
#Saved FeatureTable[Frequency] to: table-dncluster98.qza
#Saved FeatureData[Sequence] to: rep-seqs-dncluster98.qza

$ qiime feature-table summarize \
--i-table table-dncluster98.qza \
--o-visualization table-dncluster98.qzv \
--verbose

$ qiime feature-table tabulate-seqs \
--i-data rep-seqs-dncluster98.qza \
--o-visualization rep-seqs-dncluster98.qzv

$ qiime feature-classifier classify-consensus-vsearch \
 --i-query rep-seqs-dncluster98.qza \
 --i-reference-reads /mnt/d/qiime2/Database/ncbi-refseqs_12S-seqs-derep-uniq.qza \
 --i-reference-taxonomy /mnt/d/qiime2/Database/ncbi-refseqs_12S-tax-derep-uniq.qza \
 --output-dir taxonomy
#Saved FeatureData[Taxonomy] to: taxonomy/classification.qza
#Saved FeatureData[BLAST6] to: taxonomy/search_results.qza

$ qiime metadata tabulate \
--m-input-file ./taxonomy/classification.qza \
--m-input-file rep-seqs-dncluster98.qza \
--o-visualization taxonomy_consensus_blast-asv.qzv

#Barplot
$ qiime taxa barplot \
--i-table table-dncluster98.qza \
--i-taxonomy ./taxonomy/classification.qza \
--m-metadata-file metadata_12s.txt \
--o-visualization bar_plots_blast95_12S-asv.qzv 

#for 16S
$ qiime deblur denoise-16S \
  --i-demultiplexed-seqs demux-joined-filtered.qza \
  --p-trim-length 250 \
  --p-sample-stats \
  --o-representative-sequences rep-seqs.qza \
  --o-table table.qza \
  --o-stats deblur-stats.qza






